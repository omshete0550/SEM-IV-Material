CREATE TABLE CUSTOMERS( 
    CUST_ID INT PRIMARY KEY, 
    CUST_NAME VARCHAR2(25), 
    CUST_EMAIL VARCHAR2(20) 
)

desc CUSTOMERS

CREATE TABLE ORDERS( 
    ORDER_ID INT PRIMARY KEY, 
    ORDER_NAME VARCHAR2(20), 
    ORDER_DATE DATE, 
    TOTAL_AMT DECIMAL(10,2), 
    CUST_ID INT, 
    CONSTRAINTS fk_orders_customers FOREIGN KEY(CUST_ID) REFERENCES CUSTOMERS(CUST_ID) 
)

desc ORDERS


INSERT INTO CUSTOMERS(CUST_ID, CUST_NAME, CUST_EMAIL) 
VALUES(125, 'TEST1', 'test1@gmail.com')
INSERT INTO CUSTOMERS(CUST_ID, CUST_NAME, CUST_EMAIL) 
VALUES(456, 'TEST2', 'test2@gmail.com')
INSERT INTO CUSTOMERS(CUST_ID, CUST_NAME, CUST_EMAIL) 
VALUES(783, 'TEST3', 'test3@gmail.com')
INSERT INTO CUSTOMERS(CUST_ID, CUST_NAME, CUST_EMAIL) 
VALUES(874, 'TEST4', 'test4@gmail.com')
INSERT INTO CUSTOMERS(CUST_ID, CUST_NAME, CUST_EMAIL) 
VALUES(893, 'TEST5', 'test5@gmail.com')
INSERT INTO CUSTOMERS(CUST_ID, CUST_NAME, CUST_EMAIL) 
VALUES(369, 'TEST6', 'test6@gmail.com')
INSERT INTO CUSTOMERS(CUST_ID, CUST_NAME, CUST_EMAIL) 
VALUES(753, 'TEST7', 'test7@gmail.com')

SELECT * 
FROM CUSTOMERS

INSERT INTO ORDERS(ORDER_ID, ORDER_NAME, ORDER_DATE, TOTAL_AMT, CUST_ID) 
VALUES(321, 'HEADPHONES', '15-APR-2022', 2499, 125)
INSERT INTO ORDERS(ORDER_ID, ORDER_NAME, ORDER_DATE, TOTAL_AMT, CUST_ID) 
VALUES(159, 'USPA', '30-MAY-2022', 2499, 125)
INSERT INTO ORDERS(ORDER_ID, ORDER_NAME, ORDER_DATE, TOTAL_AMT, CUST_ID) 
VALUES(961, 'T-SHIRT', '21-DEC-2022', 2499, 456)
INSERT INTO ORDERS(ORDER_ID, ORDER_NAME, ORDER_DATE, TOTAL_AMT, CUST_ID) 
VALUES(489, 'SHIRT', '05-MAR-2023', 1599, 783)
INSERT INTO ORDERS(ORDER_ID, ORDER_NAME, ORDER_DATE, TOTAL_AMT, CUST_ID) 
VALUES(239, 'EARPHONES', '13-MAR-2023', 1095, 874)
INSERT INTO ORDERS(ORDER_ID, ORDER_NAME, ORDER_DATE, TOTAL_AMT, CUST_ID) 
VALUES(746, 'IPHONE 14', '23-APR-2023', 65999, 893)
INSERT INTO ORDERS(ORDER_ID, ORDER_NAME, ORDER_DATE, TOTAL_AMT, CUST_ID) 
VALUES(5461, null, null, NULL, 369)

DELETE
FROM ORDERS
WHERE ORDER_ID = 5461;    

SELECT * 
FROM ORDERS

SELECT C.CUST_NAME, SUM(O.TOTAL_AMT) AS TOTAL_ORDER_AMT
FROM CUSTOMERS C
JOIN ORDERS O
ON C.CUST_ID = O.CUST_ID
GROUP BY CUST_NAME
ORDER BY TOTAL_ORDER_AMT DESC;

SELECT O.ORDER_DATE, C.CUST_NAME, O.ORDER_ID, O.TOTAL_AMT
FROM ORDERS O
JOIN CUSTOMERS C
ON C.CUST_ID = O.CUST_ID
ORDER BY O.ORDER_DATE;

SELECT C.CUST_NAME, COUNT(*) AS ORDER_CTR
FROM CUSTOMERS C
JOIN ORDERS O
ON C.CUST_ID = O.CUST_ID
GROUP BY C.CUST_NAME;

SELECT C.CUST_NAME
FROM CUSTOMERS C
LEFT JOIN ORDERS O
ON C.CUST_ID = O.CUST_ID
WHERE O.ORDER_ID IS NULL;

SELECT C.CUST_NAME, SUM(O.TOTAL_AMT) AS TOTAL_ORDER_AMT
FROM CUSTOMERS C
LEFT JOIN ORDERS O
ON C.CUST_ID = O.CUST_ID
GROUP BY C.CUST_NAME
ORDER BY C.CUST_NAME;

SELECT *
FROM CUSTOMERS
WHERE CUST_ID IN
(
    SELECT CUST_ID
    FROM ORDERS
    WHERE TOTAL_AMT > 2000
)

SELECT C.CUST_NAME, O.ORDER_NAME, O.ORDER_DATE, O.TOTAL_AMT,
(
    SELECT COUNT(*) 
    FROM ORDERS 
    WHERE CUST_ID = C.CUST_ID
)
AS ORDER_CTR
FROM CUSTOMERS C
LEFT JOIN ORDERS O
ON C.CUST_ID = O.CUST_ID
ORDER BY C.CUST_NAME;

SELECT C.CUST_NAME, O.ORDER_NAME, O.ORDER_DATE, O.TOTAL_AMT, O.ORDER_ID,
(
    SELECT MAX(TOTAL_AMT) 
    FROM ORDERS
    WHERE CUST_ID = C.CUST_ID
)
FROM CUSTOMERS C
LEFT JOIN ORDERS O
ON C.CUST_ID = O.CUST_ID
WHERE EXISTS
(
    SELECT 8
    FROM ORDERS
    WHERE CUST_ID = C.CUST_ID
)
ORDER BY C.CUST_NAME;

